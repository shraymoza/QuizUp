version: 1
frontend:
  phases:
    preBuild:
      commands:
        - echo "preBuild phase - Current directory:"
        - pwd
        - echo "Listing files:"
        - ls -la
        - echo "Environment variable VITE_API_BASE_URL:"
        - echo $VITE_API_BASE_URL
        - |
          # Check if we're already in the frontend directory (package.json exists)
          if [ -f "package.json" ]; then
            echo "✅ Already in frontend directory (package.json found)"
            FRONTEND_DIR="."
          elif [ -d "frontend" ]; then
            echo "✅ frontend directory exists, changing to it..."
            cd frontend
            FRONTEND_DIR="frontend"
          else
            echo "❌ ERROR: Neither package.json nor frontend directory found!"
            echo "Current directory contents:"
            ls -la
            exit 1
          fi
        - echo "Current directory after check:"
        - pwd
        - echo "Installing dependencies..."
        - npm ci || npm install
    build:
      commands:
        - echo "Build phase - Current directory:"
        - pwd
        - echo "Listing files:"
        - ls -la
        - |
          # Check if we're already in the frontend directory (package.json exists)
          if [ -f "package.json" ]; then
            echo "✅ Already in frontend directory (package.json found)"
            FRONTEND_DIR="."
          elif [ -d "frontend" ]; then
            echo "✅ frontend directory exists, changing to it..."
            cd frontend
            FRONTEND_DIR="frontend"
          else
            echo "❌ ERROR: Neither package.json nor frontend directory found!"
            echo "Current directory contents:"
            ls -la
            exit 1
          fi
        - echo "Current directory after check:"
        - pwd
        - echo "Environment variable VITE_API_BASE_URL:"
        - echo $VITE_API_BASE_URL
        - echo "Building application..."
        - npm run build
  artifacts:
    baseDirectory: dist
    files:
      - '**/*'
  cache:
    paths:
      - node_modules/**/*
