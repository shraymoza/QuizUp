version: 1
frontend:
  phases:
    preBuild:
      commands:
        - echo "=== PREBUILD PHASE ==="
        - pwd
        - ls -la
        - 'echo "VITE_API_BASE_URL=$VITE_API_BASE_URL"'
        - |
          if [ -f "package.json" ]; then
            echo "✅ In frontend directory"
          elif [ -d "frontend" ]; then
            echo "✅ Changing to frontend..."
            cd frontend
          else
            echo "❌ ERROR: frontend not found!"
            exit 1
          fi
        - pwd
        - 'test -f package.json || (echo "❌ package.json not found!" && exit 1)'
        - echo "✅ Installing dependencies..."
        - npm install
    build:
      commands:
        - echo "=== BUILD PHASE START ==="
        - pwd
        - |
          if [ -f "package.json" ]; then
            echo "✅ In frontend directory"
          elif [ -d "frontend" ]; then
            echo "✅ Changing to frontend..."
            cd frontend
          else
            echo "❌ ERROR: frontend not found!"
            exit 1
          fi
        - pwd
        - 'test -f package.json || (echo "❌ package.json not found!" && exit 1)'
        - 'echo "VITE_API_BASE_URL before export: $VITE_API_BASE_URL"'
        - |
          if [ -z "$VITE_API_BASE_URL" ]; then
            echo "❌ ERROR: VITE_API_BASE_URL is not set!"
            exit 1
          fi
        - export VITE_API_BASE_URL
        - 'echo "✅ VITE_API_BASE_URL=$VITE_API_BASE_URL"'
        - echo "Building with Vite..."
        - npm run build
        - echo "Build complete. Checking dist..."
        - 'ls -la dist || (echo "❌ dist not found!" && exit 1)'
        - echo "=== BUILD PHASE END ==="
  artifacts:
    baseDirectory: frontend/dist
    files:
      - '**/*'
  cache:
    paths:
      - node_modules/**/*
