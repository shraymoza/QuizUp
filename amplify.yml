version: 1
frontend:
  phases:
    preBuild:
      commands:
        - echo "preBuild phase - Current directory:"
        - pwd
        - echo "Listing files:"
        - ls -la
        - echo "Environment variable VITE_API_BASE_URL:"
        - echo $VITE_API_BASE_URL
        - |
          # Determine the working directory and change to it
          if [ -f "package.json" ]; then
            echo "✅ Already in frontend directory (package.json found)"
            WORK_DIR="."
          elif [ -d "frontend" ]; then
            echo "✅ frontend directory exists, changing to it..."
            cd frontend
            WORK_DIR="frontend"
          else
            echo "❌ ERROR: Neither package.json nor frontend directory found!"
            echo "Current directory contents:"
            ls -la
            exit 1
          fi
          echo "Current directory after check:"
          pwd
          echo "Verifying package.json exists:"
          if [ ! -f "package.json" ]; then
            echo "❌ package.json NOT found in current directory!"
            exit 1
          fi
          echo "✅ package.json found"
          echo "Installing dependencies..."
          npm install
    build:
      commands:
        - |
          # Build phase - determine working directory and build
          echo "Build phase - Current directory:"
          pwd
          echo "Listing files:"
          ls -la
          
          # Determine the working directory and change to it
          if [ -f "package.json" ]; then
            echo "✅ Already in frontend directory (package.json found)"
            WORK_DIR="."
          elif [ -d "frontend" ]; then
            echo "✅ frontend directory exists, changing to it..."
            cd frontend
            WORK_DIR="frontend"
          else
            echo "❌ ERROR: Neither package.json nor frontend directory found!"
            echo "Current directory contents:"
            ls -la
            exit 1
          fi
          
          echo "Current directory after check:"
          pwd
          echo "Verifying package.json exists:"
          if [ ! -f "package.json" ]; then
            echo "❌ package.json NOT found in current directory!"
            exit 1
          fi
          echo "✅ package.json found"
          echo "Environment variable VITE_API_BASE_URL:"
          echo $VITE_API_BASE_URL
          echo "Building application..."
          npm run build
          
          echo "Verifying dist directory was created:"
          if [ ! -d "dist" ]; then
            echo "❌ ERROR: dist directory was NOT created after build!"
            echo "Current directory contents:"
            ls -la
            exit 1
          fi
          echo "✅ dist directory created successfully"
          ls -la dist
  artifacts:
    baseDirectory: dist
    files:
      - '**/*'
  cache:
    paths:
      - node_modules/**/*
